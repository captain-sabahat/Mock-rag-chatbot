################################################################################
# VECTOR DATABASE CONFIGURATION
################################################################################

vectordb:
  # Which backend to use
  active_backend: "faiss"     # "qdrant", "pinecone", "faiss", "weaviate", "chromadb", "milvus"

  # QDRANT backend (default OSS)
  qdrant:
    enabled: false
    deployment_mode: "local"   # "local" or "remote"

    local:
      api_endpoint: "http://localhost:6333"
      use_http: false

    remote:
      api_endpoint: "${QDRANT_REMOTE_ENDPOINT}"
      api_key_env_var: "${QDRANT_API_KEY}"

    collection:
      name: "documents"
      vector_size: 768
      distance: "cosine"       # "cosine", "euclidean", "dot"
      payload_schema:
        chunk_id: "text"
        request_id: "text"
        file_name: "text"
        chunk_index: "integer"
        chunk_text: "text"
        created_at: "text"
        embedding_model: "text"

    batch_size: 100
    timeout_seconds: 30
    enable_replication: false
    enable_snapshot: false

  # PINECONE backend (managed)
  pinecone:
    enabled: false
    api_key_env_var: "${PINECONE_API_KEY}"
    api_endpoint: "https://api.pinecone.io"
    project_id: "${PINECONE_PROJECT_ID}"
    environment: "gcp-starter"

    index:
      name: "documents"
      dimension: 768
      metric: "cosine"

    metadata_index:
      - "request_id"
      - "file_name"
      - "chunk_index"
      - "created_at"

    batch_size: 100
    timeout_seconds: 30
    pod_type: "s1"

  # FAISS backend (local library)
  faiss:
    enabled: true
    index_path: "./data/faiss_indices"
    index_name: "documents.idx"
    dimension: 768
    index_type: "HNSW"
    faiss_params:
      m: 16
      ef_construction: 200
      ef_search: 100
    metadata_backend: "sqlite"
    metadata_db: "./data/faiss_metadata.db"
    batch_size: 100
    timeout_seconds: 30

  # WEAVIATE backend
  weaviate:
    enabled: false
    deployment_mode: "local"
    api_endpoint: "http://localhost:8080"
    api_key_env_var: "${WEAVIATE_API_KEY}"
    class:
      name: "DocumentChunk"
      vector_index_type: "hnsw"
    batch_size: 100
    timeout_seconds: 30

  # CHROMADB backend
  chromadb:
    enabled: false
    mode: "persistent"               # "in_memory", "persistent", "http"
    persist_directory: "./data/chroma"
    http_client:
      api_endpoint: "http://localhost:8000"
    collection:
      name: "documents"
      metadata_fields:
        - "request_id"
        - "file_name"
        - "chunk_index"
    batch_size: 100
    timeout_seconds: 30

  # MILVUS backend
  milvus:
    enabled: false
    host: "localhost"
    port: 19530
    username: "${MILVUS_USERNAME}"
    password_env_var: "${MILVUS_PASSWORD}"
    collection:
      name: "documents"
      dimension: 768
      index_type: "IVF_FLAT"
    batch_size: 100
    timeout_seconds: 30

  # Global settings
  global:
    max_retries: 3
    retry_delay_seconds: 2
    timeout_seconds: 30
    validate_dimension: true
    validate_before_upsert: true
    search:
      default_top_k: 5
      min_score_threshold: 0.5
    fallback_enabled: true
    fallback_backend: "faiss"
    connection_pool_size: 10
    connection_timeout_seconds: 5

  # Security
  security:
    log_api_keys: false
    mask_api_keys: true
    verify_ssl: true
    ca_cert_path: ""

  # Monitoring
  monitoring:
    mlflow_enabled: true
    log_metrics:
      - "chunks_stored"
      - "upsert_time_ms"
      - "search_time_ms"
      - "avg_search_latency_ms"
      - "index_size_mb"
      - "backend_used"
    alerts:
      - condition: "search_time_ms > 1000"
        severity: "warning"
      - condition: "upsert_time_ms > 5000"
        severity: "error"

  # Resource limits
  resource:
    max_index_size_mb: 5000
    max_queries_per_second: 100
    max_upserts_per_minute: 1000

  # Data retention
  retention:
    enable_auto_delete: false
    delete_after_days: 365
    enable_backups: true
    backup_frequency: "daily"
    backup_location: "./backups/vectordb"
